on: push
name: Publish Website
jobs:
  FTP-Deploy-Action:
    name: FTP-Deploy-Action
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        fetch-depth: 2
    - name: Add untracked file
      run: |
        touch untracked-file-probably-composer-vendor.php
    - name: Store files from repo
      run: |
        find . -mindepth 1 -not -path "./.git*" > .git-ftp-files.log
        echo !.git-ftp-files.log > .git-ftp-include
    - name: Deploy files via SFTP
      uses: pressidium/lftp-mirror-action@v1
      with:
        # SFTP credentials
        host: sftp.wp.com
        port: 22
        user: ${{ secrets.FTP_USER }}
        pass: ${{ secrets.FTP_PASSWORD }}
        # lftp settings
        onlyNewer: true
        settings: 'sftp:auto-confirm=yes'
        # Mirror command options
        localDir: '.'
        remoteDir: '/htdocs'
        reverse: true
        ignoreFile: '.lftp_ignore'
        options: '--verbose'
